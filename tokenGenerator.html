<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Tokenizer Generator</title>
		<meta name="description" content="Tokenise Your World with Ease: Introducing Tokeniser - Your One-Click Solution for Creating and Managing Tokens. From Transactions to Ownership, Unleash the Potential Today!" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
        <!-- favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/favicon-16x16.png">
        <link rel="manifest" href="/assets/images/favicon/site.webmanifest">

		<!-- bootstarp -->
		<link rel="stylesheet" href="css/vendors/bootstrap.min.css">
		
		<!-- animate.css file -->
		<link rel="stylesheet" href="css/vendors/animate.css">
		
		<!-- Swiper -->
		<link rel="stylesheet" href="css/vendors/swiper-bundle.min.css">
		
		<!-- flaticon -->
		<link rel="stylesheet" href="css/vendors/flaticon/flaticon.css">
		
		<!-- fontAwesome -->
		<link rel="stylesheet" href="css/vendors/all.min.css">
		
		<!-- bootstrap icons -->
		<link rel="stylesheet" href="css/vendors/bootstrap-icons-1.9.1/bootstrap-icons.css">
		
		<!-- Fancybox -->
		<link rel="stylesheet" href="css/vendors/jquery.fancybox.min.css">
		
		<!-- fonts site preconnect -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		
		<!-- fonts site preconnect -->
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		
		<!-- Font Family -->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;600;700;800&amp;display=swap">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
		<!-- main-LTR -->
		<link rel="stylesheet" href="css/main-LTR.css">
        <link rel="stylesheet" href="tokenGenStyle.css">
        <style>
            body {
                background-color: #fff;
            }
            #metamaskButton {
                border: solid 2px #444;
                border-radius: 8px;;
                font-size:20px;
                padding: 15px 30px 15px 65px;
                background: #dd6e2e;
                background-image: url("assets/images/tokenGenerator/metamaskLogo.png");
                background-size: 40px;
                background-repeat: no-repeat;
                background-position: 20px;
                font-weight: bold;
                color: #fff;
                box-shadow: inset 2px 2px 0 #fff, 0 8px 10px -4px rgba(0,0,0,0.4);
                cursor: pointer;
                transition: all 0.4s ease;
            }
          
            #metamaskButton:hover {
                border: solid 2px #444;
                border-radius: 8px;;
                font-size:20px;
                padding: 15px 30px 15px 65px;
                background: #f18b50;
                background-image: url("assets/images/tokenGenerator/metamaskLogo.png");
                background-size: 40px;
                background-repeat: no-repeat;
                background-position: 20px;
                font-weight: bold;
                color: #fff;
                box-shadow: inset 2px 2px 0 #fff, 0 8px 10px -4px rgba(0,0,0,0.4);
                cursor: pointer;
                transition: all 0.4s ease;
            }

            label {
                color:black !important;
            }

            #formTips {display: none;}
        </style>

        
<script src="https://c0f4f41c-2f55-4863-921b-sdk-docs.github.io/cdn/metamask-sdk.js"></script>

<script>

    const MMSDK = new MetaMaskSDK.MetaMaskSDK()
    // Because init process of the MetaMaskSDK is async.
    setTimeout(() => {
        const ethereum = MMSDK.getProvider() // This can also be accessed via window.ethereum

        ethereum.request({ method: 'eth_requestAccounts' })
    }, 0)

</script>
	</head>
	<body class="h-100">
		<!--Start Page Header-->
		<header class=" header-basic" id="page-header">
			<div class="container">
				<!--Start navbar-->
				<nav class="menu-navbar" id="main-nav">
					<!-- logo image is repeating 2 times above due to navbar old setup, needs to be reviewed -->
					<div class="header-logo"><a class="logo-link" href="https://supertokenizer.github.io/" alt="logo"><img class="logo-img light-logo" loading="lazy" src="assets/images/logo/logo-dark.png" alt="logo"/><img class="logo-img  dark-logo" loading="lazy" src="assets/images/logo/logo-dark.png" alt="logo"/></a></div>
					<div class="links menu-wrapper ">
						<ul class="list-js links-list">
							<li class="nav-item menu-item has-sub-menu"><a class="nav-link menu-link   active" href="/index.html/">HOME</a></li>
							<li class="nav-item menu-item"><a class="nav-link menu-link" href="/index.html/#about">ABOUT</a></li>
							<li class="nav-item menu-item"><a class="nav-link menu-link" href="/index.html/#howItWorks">HOW IT WORKS</a></li>
							<li class="nav-item menu-item"><a class="nav-link menu-link" href="/index.html/#faq">FAQ </a></li>
							<!-- <li class="nav-item menu-item"><a class="nav-link menu-link" href="/index.html/#contact-us">CONTACT</a></li> -->
						</ul>
                        
					</div>
					<div class="controls-box">
						<!--Menu Toggler button-->
						<div class="control menu-toggler"><span></span><span></span><span></span></div>
					</div>
				</nav>
			</div>
			<!--End navbar-->
		</header>
		<!--End Page Header-->
        		<!-- Start  about Section-->
		<section class="about mega-section align-items-center" id="about">
			<div class="container">
				<!-- Start first about div-->
				<div class="content-block m-auto">
					<div class="row">
						<div class="col-12 d-flex justify-content-center mx-auto about-col pad-end">
							<div class="text-area pb-0">
								<div class="sec-heading centered light-title ">
									<div class="content-area text-center d-flex justify-content-center">
										<h2 class=" title wow fadeInUp" data-wow-delay=".2s"><span class='hollow-text d-flex justify-content-center'>TOKENIZER</span></h2>
									</div>

                                    <h3>Creating tokens for <span class='featured-text'>  anything.
												<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 150" preserveAspectRatio="none">
													<path d="M7.7,145.6C109,125,299.9,116.2,401,121.3c42.1,2.2,87.6,11.8,87.3,25.7"></path></svg>
												</span>
											</h3>
								</div>
								<p class="about-text">
                                    The world's pioneering tool that empowers anyone to establish a token with a mere click.
									Yet, that's not all; it also crafts all the essential components a token necessitates for its effective existence, encompassing logos,
									 web pages, and more. So, dispel your apprehensions, for in the imminent future, we're poised to tokenise everything!
								</p>
							</div>
						</div>
					</div>
                    <!-- Prompt user to connect to metamask first to ensure better flexibility on mobile -->
                    <div id="connectFirst" class="container mt-0">
                        <div class="row justify-content-center">
                            <div class="col-12 col-md-8 col-lg-6">
                                <div class="card shadow-lg">
                                    <div class="card-body">
                                        <div class="alert alert-info">
                                            Before you can start to generate awesome tokens, you need to connect your MetaMask to the Tokenizer.
                                        </div>
                                        <button id="metamaskButton" class="btn btn-primary btn-block mt-3">Connect MetaMask</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="formContainer" class="container h-100 mt-0 d-none">
                        <div class="row h-100 justify-content-center align-items-center">
                            <div class="col-10 col-md-8 col-lg-6">
                                
                                <div class="card shadow-lg">
                                <div id="generationMessage" class="alert alert-info d-none" role="alert">
                                    Token generation in progress. You can view the progress on the <a id="blockExplorerLink" href="" class="d-none" target="_blank">block explorer</a>.
                                </div>
                                <div class="card-body">
                                    <div id="successMessage" class="alert alert-success d-none"></div>
                                <!-- Form -->
                                <form class="form d-none" id="tokenForm" method="POST" >
                                    <h3 class="card-title m-3 text-dark">Token Information</h3>
                                    <p class="description card-title m-3 text-dark">Basic details about your token.</p>
                                    <div id="networkSwitchMessage" class="alert alert-info d-none"></div>
                                    <!-- Input fields -->
                                    <fieldset class="form-group">
                                        <label for="tokenType" key="typeOfToken">Select Type OF Token</label>
                                        <select  id = "tokenType" class="form-control" name="tokenType" required>
                                            <option value="bep20">BEP20</option>
                                            <option value="erc20">ERC20</option>
                                        </select>
                                    <div class="form-group NameField mb-3">
                                        <label for="tokenName" key="tokenName">Token Name:</label>
                                        <input type="text" class="form-control" id="tokenName" 
                                            placeholder="Token Name (For example: BestToken)" name="tokenName" required>
                                    </div>
                                    <div class="form-group SymbolField mb-3">
                                        <label for="tokenSymbol" key="tokenSymbol">Token Symbol:</label>
                                        <input type="text" class="form-control" id="tokenSymbol" 
                                            placeholder="Token Symbol (For example: BST)" name="tokenSymbol" required>
                                    </div>
                                    
                                    <fieldset class="form-group MaxSupplyField mb-3">
                                        <label for="maxSupply" key="maxSupply">Max Supply Amount (<= 10 000):</label>
                                        <input id="maxSupply" class="form-control" name="maxSupply" type="number" min="1" max="100000" required/>
                                    </fieldset>
                                      <br>
                                      <div id="errorMessage" class="alert alert-danger d-none"></div>
                                        <img id="loader1" src="loading.gif" alt=""></img>
                                    <button  id="TokenSubmit" class="btn btn-primary ml-auto" type="submit" title="Next">Create Token</button>
                                    <!-- End input fields -->
                                </form>
                                
                                <!-- Form end -->
                            </div>
                        </div>
                    </div>
				</div>
				<!--End first about div-->
				<!-- Start first about div-->
            </div>
                </div>
            </div>
        </section>
            <!-- End back-to-top Component-->   
            <!--     JQuery     -->
            <script src="js/vendors/jquery-3.6.1.min.js"></script>
            <!--     appear     -->
            <script src="js/vendors/appear.min.js"></script>
            <!--     bootstrap     -->
            <script src="js/vendors/bootstrap.bundle.min.js"></script>
            <!--     countTo     -->
            <script src="js/vendors/jquery.countTo.js"></script>
            <!--     wow     -->
            <script src="js/vendors/wow.min.js"></script>
            <!--     swiper     -->
            <script src="js/vendors/swiper-bundle.min.js"></script>
            <!--     particles     -->
            <script src="js/vendors/particles.min.js"></script>
            <!--     Vanilla-tilt     -->
            <script src="js/vendors/vanilla-tilt.min.js"></script>
            <!--     isotope     -->
            <script src="js/vendors/isotope-min.js"></script>
            <!--     fancybox     -->
            <script src="js/vendors/jquery.fancybox.min.js"></script>
            <!--     main     -->
            <script src="js/main.js"></script>
            <script src="js/sweetAlert.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
            <script>
            document.getElementById('metamaskButton').addEventListener('click', async (event) => {
            let button = event.target;

            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                let accountAddress = accounts[0];
                console.log(accountAddress);
                document.getElementById('connectFirst').classList.add('d-none');
                document.getElementById('tokenForm').classList.remove('d-none');
                document.getElementById('formContainer').classList.remove('d-none');
            } catch (error) {
                console.error("Error requesting accounts:", error);
            } 
            
        });

        async function connectWeb3() {
            if (window.ethereum) {
                window.web3 = new Web3(window.ethereum);
             }
        }

        async function load() {
            await connectWeb3();
            window.contract = await loadContract(contractAddresses.bep20); // Default to BEP20;
            // updateStatus('Ready!');
        }

        // Define your contract ABI and address here
        const contractABI = [
            {
                "inputs": [
                    {
                    "internalType": "string",
                    "name": "name",
                    "type": "string"
                    },
                    {
                    "internalType": "string",
                    "name": "symbol",
                    "type": "string"
                    },
                    {
                    "internalType": "uint256",
                    "name": "maxSupply",
                    "type": "uint256"
                    }
                ],
                "name": "newToken",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
                },
                {
                "inputs": [
                    {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                    },
                    {
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                    }
                ],
                "name": "tokens",
                "outputs": [
                    {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
                }
        ];

        const contractAddresses = {
        bep20: '0xBD8D5Acba4f00ffeA7EC84b830028fB4d5a18060', // BEP20 contract address
        erc20: '0xc832b4f7E542A4eCc087a37BB12b4B8c2b109f22', // ERC20 contract address
    };
    const bscMainnet = {
    chainId: '0x61' // Binance Smart Chain testnet (assuming Chain ID 97)
};

const sepoliaTestnet = {
    chainId: '0xaa36a7' // Sepolia Ethereum Testnet
};
async function switchNetworkAndAccount(chainId) {
    try {
        document.getElementById('networkSwitchMessage').textContent = 'Setting up your metamask...';
        document.getElementById('networkSwitchMessage').classList.add('d-block');
        // Switch to the selected network
        await ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId }]
        });

        // Prompt the user to select an account after network switch
        await ethereum.request({
            method: 'wallet_requestPermissions',
            params: [{ eth_accounts: {} }]
        });

        document.getElementById('networkSwitchMessage').textContent = 'Account successfully set up!';
    } catch (error) {
        document.getElementById('networkSwitchMessage').textContent = '';
        if (error.code === 4001) {
            document.getElementById('networkSwitchMessage').textContent = 'Permissions needed to continue.';
        } else {
            document.getElementById('networkSwitchMessage').textContent = 'Error switching network or requesting permissions.';
            console.error("Error switching network or requesting permissions:", error);
        }
    }
}

                    async function testPending(){ 
                        web3.eth.getPendingTransactions().then((pendingTransactions) => {
                        if (pendingTransactions.length > 0) {
                            alert(`Transaction ${transactionHash} is still pending...`);
                            document.getElementById('tokenForm').classList.add('d-none');
                            document.getElementById('generationMessage').textContent = 'Transaction is still pending...';
                            document.getElementById('generationMessage').classList.remove('d-none');
                        }
                    });
                }

        async function loadContract(contractAddress) {
            const web3 = new Web3(ethereum);
            return new web3.eth.Contract(contractABI, contractAddress);
            alert('check pending1.');
        }

        async function getCurrentAccount() {
            try {
                const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                return accounts[0];
            } catch (error) {
                console.error("Error requesting accounts:", error);
            }
        }

        const tokenForm = document.getElementById("tokenForm");
        const tokenTypeSelect = document.getElementById('tokenType');
        // Define a mapping of token types to block explorer URLs
        const blockExplorerUrls = {
            bep20: 'https://testnet.bscscan.com/tx/',
            erc20: 'https://sepolia.etherscan.io/tx/',
        };

       // Variable to keep track of whether the user has confirmed the transaction
let userConfirmed = false;

// Listen for user confirmation of the transaction
ethereum.on('wallet:transactions:confirmation', (transaction) => {
    userConfirmed = true;
    alert(`Transaction in progress !`);
    document.getElementById('tokenForm').classList.add('d-none');
    document.getElementById('generationMessage').textContent = 'Token generation in progress.';
    document.getElementById('generationMessage').classList.remove('d-none');
    document.getElementById('generationMessage').classList.add('alert-info');
});

// Listen for blockchain confirmation
ethereum.on('confirmation', (confirmationNumber, receipt) => {
    if (confirmationNumber === 1 && userConfirmed) {
        // The transaction is confirmed on the blockchain, and the user has confirmed it
        alert(`✅The transaction was successful! \nHash: ${receipt.transactionHash}`);
        document.getElementById('tokenForm').classList.add('d-none');
        document.getElementById('generationMessage').textContent = 'Your token was successfully created!';
        document.getElementById('generationMessage').classList.add('alert-success');
    }
});

        tokenForm.addEventListener("submit", async function (event) {
            event.preventDefault();
            load();
            
            const formData = new FormData(tokenForm);
            // const tokenType = formData.get("tokenType");
            const tokenName = formData.get("tokenName");
            const tokenSymbol = formData.get("tokenSymbol");
            const maxSupply = formData.get("maxSupply");
            const selectedOption = tokenTypeSelect.value;
            let contractToUse;

            if (selectedOption === 'bep20') {
                contractToUse = contractAddresses.bep20;
                await switchNetworkAndAccount(bscMainnet.chainId);
                //selectedNetwork = { chainId: '0x61' };  BSC Mainnet 0x38 Testnet 0X61
            } else if (selectedOption === 'erc20') {
                contractToUse = contractAddresses.erc20;
                 // selectedNetwork = { chainId: '0xaa36a7' };Ethereum Mainnet 0x1 Sepolia 0xaa36a7?
                 await switchNetworkAndAccount(sepoliaTestnet.chainId);
            } else {
                console.error('Invalid token type selected.');
                return;
            }

            const requestData = {
                name: tokenName,
                symbol: tokenSymbol,
                maxSupply: web3.utils.toWei(maxSupply, 'ether'), // Convert to wei,
            };
            const account = await getCurrentAccount();
            const contract = await loadContract(contractToUse);
            
            try {
                document.getElementById('generationMessage').textContent = 'Please confirm your transaction in MetaMask.';
                const gasPrice = await web3.eth.getGasPrice();
                const transaction = await contract.methods.newToken(requestData.name, requestData.symbol, requestData.maxSupply).send({
                    from: account,
                    gasPrice: gasPrice,
                });
                 // Transaction sent, show pending message immediately
                // alert(`Transaction ${transaction.transactionHash} is still pending...`);
                // tokenForm.classList.add('d-none');
               
                // document.getElementById('generationMessage').textContent = 'Transaction is still pending...';
                // document.getElementById('generationMessage').classList.remove('d-none'); 
                // document.getElementById('generationMessage').classList.add('alert-success');
                // let blockExplorerLink;

                // if (selectedOption === 'bep20') {
                //     blockExplorerLink = `${blockExplorerUrls.bep20}`;
                // } else if (selectedOption === 'erc20') {
                //     blockExplorerLink = `${blockExplorerUrls.erc20}`;
                // } else {
                //     console.error('Invalid token type selected.');
                // }
               
                // async function verifyTransaction(transactionHash) {
                //     // Get the transaction receipt
                //     const receipt = await web3.eth.getTransactionReceipt(transactionHash);
                //      //Check if the receipt is not yet available
                //      if (receipt == null) {
                //          alert(`Transaction ${transactionHash} is still pending...`);
                //          document.getElementById('generationMessage').textContent = 'Transaction is still pending...';
                //          document.getElementById('generationMessage').classList.remove('d-none');
                //      }
                //     // check if there is any pending transaction
                   
                //     // Check if the transaction was successful
                //     if (receipt.status) {
                //         alert(`✅The transaction was successful! \nHash: ${transactionHash}`);
                //     } else {
                //         alert(`💥The transaction failed. \nHash: ${transactionHash}`);
                //     }
                // }
                // verifyTransaction(transaction.transactionHash);
                // Transaction submitted, hide the form and show the generating message 
                //This is taking too long and only shows the next msg after the transaction is already confirmed
               
                // document.getElementById('generationMessage').textContent = 'Token generation success...';
               
                
            } catch (error) {
                console.error("Error submitting transaction:", error);
            }
                        //here the transaction was already confirmed by metamask for testing purposes
    });

            </script>
    </body>
</html>
